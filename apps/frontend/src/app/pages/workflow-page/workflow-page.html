<div
  class="diagram-host"
  (mousemove)="onDiagramMouseMove($event)"
  (pointerdown)="onDiagramPointerDown($event)"
>
  @if (workflow$ | async; as wf) {
    <ng-diagram
      class="diagram"
      [model]="model"
      [config]="config"
      [nodeTemplateMap]="nodeTemplateMap"
      (diagramInit)="onDiagramInit()"
      (selectionMoved)="onSelectionMoved()"
      (edgeDrawn)="onEdgeDrawn($event)"
    >
      <ng-diagram-background />
    </ng-diagram>

    <div class="controls">
      <button class="btn" (click)="addNode()"><app-icon name="add-line" /> Add</button>

      <button class="btn btn-primary" (click)="saveGraph()" [disabled]="!editorDirty()">
        <app-icon name="save-line" /> Save
      </button>

      <button class="btn btn-accent" (click)="startRun(wf.id)">
        <app-icon name="play-line" /> Run
      </button>

      <button type="button" class="btn" (click)="undo()">Undo</button>
      <button type="button" class="btn" (click)="redo()">Redo</button>

      <button type="button" class="btn" (click)="resetToLastSaved()">Reset</button>
    </div>
  }
  <button class="runbar-toggle" (click)="runbarOpen = !runbarOpen">
    <span>Runs</span>
    <div class="runbar-toggle__icon">
      <app-icon name="arrow-left-s-line" />
    </div>
  </button>
</div>

<div class="runbar" [class.open]="runbarOpen">
  <app-workflow-run-list-container class="runs-panel" />
</div>
