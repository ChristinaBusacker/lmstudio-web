<div
  class="diagram-host"
  (mousemove)="onDiagramMouseMove($event)"
  (pointerdown)="onDiagramPointerDown($event)"
>
  @if (workflow$ | async; as wf) {
    <ng-diagram
      class="diagram"
      [model]="model"
      [config]="config"
      [nodeTemplateMap]="nodeTemplateMap"
      (diagramInit)="onDiagramInit()"
      (selectionMoved)="onSelectionMoved()"
      (edgeDrawn)="onEdgeDrawn($event)"
    >
      <ng-diagram-background />
    </ng-diagram>

    <div class="lefttop">
      <div class="title">
        <b>{{ wf.name }}</b>
      </div>
    </div>

    <div class="controls">
      <button class="btn" (click)="addNode()">
        <app-icon name="add-line" />
        <span>Add</span>
      </button>

      <button class="btn btn-primary" (click)="saveGraph()" [disabled]="!editorDirty()">
        <app-icon name="save-line" />
        <span>Save</span>
      </button>

      <button class="btn btn-accent" (click)="startRun(wf.id)">
        <app-icon name="play-line" />
        <span>Run</span>
      </button>

      <button type="button" class="btn" (click)="undo()">
        <app-icon name="arrow-go-back-line" />
        <span>Undo</span>
      </button>
      <button type="button" class="btn" (click)="redo()">
        <app-icon name="arrow-go-forward-line" />
        <span>Redo</span>
      </button>

      <button type="button" class="btn" (click)="resetToLastSaved()">
        <app-icon name="reset-left-line" />
        <span>Reset</span>
      </button>
    </div>
  }
  <button class="runbar-toggle" (click)="runbarOpen = !runbarOpen" [class.open]="runbarOpen">
    <span>Runs</span>
    <div class="runbar-toggle__icon">
      <app-icon name="arrow-left-s-line" />
    </div>
  </button>
</div>

<div class="runbar" [class.open]="runbarOpen">
  <app-workflow-run-list-container class="runs-panel" />
</div>
