<div class="node">
  <!-- Ports (match default ids from docs: port-left / port-right) -->
  <ng-diagram-port id="port-left" side="left" type="both"></ng-diagram-port>
  <ng-diagram-port id="port-right" side="right" type="both"></ng-diagram-port>

  <div class="header">
    <div class="title">{{ title() }}</div>
    <div class="sub">{{ node().data.nodeType }}</div>
  </div>

  <div class="body">
    <label class="field">
      <div class="label">Node Type</div>
      <select
        class="config input"
        [value]="node().data.nodeType"
        (change)="updateNodeType($event.target.value)"
      >
        <option value="lmstudio.llm">lmstudio.llm</option>
        <option value="workflow.condition">workflow.condition</option>
        <option value="workflow.loop">workflow.loop</option>
        <option value="stable-diffusion.txt2img">stable-diffusion.txt2img</option>
      </select>
    </label>

    <label class="field">
      <div class="label">Input (from node)</div>
      <select
        class="config input"
        [value]="node().data.inputFrom"
        (change)="updateInputFrom($event.target.value)"
        title="Execution order is derived from this dependency"
      >
        <option value="">None</option>
        @for (id of upstreamNodeOptions(); track id) {
          <option [value]="id" [selected]="id === node().data.inputFrom">{{ id }}</option>
        }
      </select>
    </label>

    <label class="field">
      <div class="label">Profile</div>
      <select
        class="config input"
        [value]="node().data.profileName"
        (change)="updateProfileName($event.target.value)"
        #configSelect
        title="Visit settings to define presets"
      >
        <option value="">Default</option>
        @for (profile of profiles$ | async; track $index) {
          <option [value]="profile.name" [selected]="profile.name === node().data.profileName">
            {{ profile.name }}
          </option>
        }
      </select>
    </label>

    <label class="field">
      <div class="label">Prompt</div>
      <textarea
        class="textarea"
        rows="5"
        [value]="node().data.prompt"
        (input)="promptInput$.next($any($event.target).value)"
        placeholder="Prompt fÃ¼r diesen Schritt..."
      ></textarea>
    </label>

    <ng-diagram-node-resize-adornment />
    <ng-diagram-node-rotate-adornment />
  </div>

  <div class="controls">
    <button (click)="duplicateNode()">
      <app-icon name="file-copy-line" title="duplicate" />
    </button>
    <button (click)="deleteNode()">
      <app-icon name="delete-bin-line" title="delete" />
    </button>
  </div>
</div>
